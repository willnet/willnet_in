# frozen_string_literal: true

require 'rubygems'
require 'bundler/setup'
require 'uri'
require 'time'

Bundler.require(:default)

class App < Sinatra::Base
  get '/' do
    redirect 'https://willnet.jp/', 301
  end

  get '/up' do
    return 200
  end

  get '/index.atom' do
    redirect to('https://blog.willnet.in/feed')
  end

  get %r{/([0-9]+)} do |id|
    result = DATA.bsearch { |data| data[:id] >= id.to_i }
    return 404 if result.nil?

    redirect "https://blog.willnet.in/entry/#{result[:created_at]}", 301
  end

  error 404 do
    'Not Found'
  end
end

DATA = [{ id: 1, created_at: '2011/12/27/013908' },
        { id: 2, created_at: '2011/12/26/081714' },
        { id: 3, created_at: '2011/12/27/020054' },
        { id: 4, created_at: '2012/01/17/005422' },
        { id: 5, created_at: '2012/01/30/112724' },
        { id: 6, created_at: '2012/02/06/103307' },
        { id: 7, created_at: '2012/02/20/130944' },
        { id: 8, created_at: '2012/02/23/152310' },
        { id: 9, created_at: '2012/04/03/104623' },
        { id: 10, created_at: '2012/06/03/000521' },
        { id: 11, created_at: '2012/06/09/173323' },
        { id: 12, created_at: '2012/06/09/175501' },
        { id: 13, created_at: '2012/06/16/212313' },
        { id: 14, created_at: '2012/06/19/225057' },
        { id: 15, created_at: '2012/07/02/154105' },
        { id: 16, created_at: '2012/07/04/233839' },
        { id: 17, created_at: '2012/07/18/141417' },
        { id: 18, created_at: '2012/08/02/002354' },
        { id: 19, created_at: '2012/08/06/162720' },
        { id: 20, created_at: '2012/08/10/145148' },
        { id: 21, created_at: '2012/08/19/170133' },
        { id: 22, created_at: '2012/08/21/123102' },
        { id: 23, created_at: '2012/08/23/000915' },
        { id: 24, created_at: '2012/08/24/123744' },
        { id: 25, created_at: '2012/08/25/201813' },
        { id: 26, created_at: '2012/08/31/175820' },
        { id: 27, created_at: '2012/09/01/164424' },
        { id: 28, created_at: '2012/09/01/173508' },
        { id: 29, created_at: '2012/09/01/175857' },
        { id: 30, created_at: '2012/09/01/182846' },
        { id: 31, created_at: '2012/09/02/220124' },
        { id: 32, created_at: '2012/09/10/154714' },
        { id: 33, created_at: '2012/09/11/114842' },
        { id: 34, created_at: '2012/09/11/160556' },
        { id: 35, created_at: '2012/09/11/162918' },
        { id: 36, created_at: '2012/09/17/143847' },
        { id: 37, created_at: '2012/09/24/010459' },
        { id: 38, created_at: '2012/09/25/010353' },
        { id: 39, created_at: '2012/09/25/181034' },
        { id: 40, created_at: '2012/09/27/112651' },
        { id: 41, created_at: '2012/09/28/100245' },
        { id: 42, created_at: '2012/10/03/152938' },
        { id: 43, created_at: '2012/10/03/163223' },
        { id: 44, created_at: '2012/10/12/112918' },
        { id: 45, created_at: '2012/10/21/000918' },
        { id: 46, created_at: '2012/10/21/160240' },
        { id: 47, created_at: '2012/10/22/212555' },
        { id: 48, created_at: '2012/10/26/005901' },
        { id: 49, created_at: '2012/10/28/151935' },
        { id: 50, created_at: '2012/10/29/225845' },
        { id: 51, created_at: '2012/11/01/235827' },
        { id: 52, created_at: '2012/11/11/083815' },
        { id: 53, created_at: '2012/11/13/074123' },
        { id: 54, created_at: '2012/11/26/002440' },
        { id: 55, created_at: '2012/12/05/004010' },
        { id: 56, created_at: '2012/12/09/131702' },
        { id: 57, created_at: '2012/12/10/213128' },
        { id: 58, created_at: '2012/12/12/224211' },
        { id: 59, created_at: '2012/12/16/210550' },
        { id: 60, created_at: '2012/12/16/231747' },
        { id: 61, created_at: '2012/12/22/225607' },
        { id: 62, created_at: '2012/12/24/232016' },
        { id: 63, created_at: '2012/12/28/173610' },
        { id: 64, created_at: '2012/12/29/170832' },
        { id: 65, created_at: '2012/12/31/000930' },
        { id: 66, created_at: '2013/01/07/001748' },
        { id: 67, created_at: '2013/01/07/213008' },
        { id: 68, created_at: '2013/01/14/205702' },
        { id: 69, created_at: '2013/01/15/221530' },
        { id: 70, created_at: '2013/01/19/001437' },
        { id: 71, created_at: '2013/01/21/233946' },
        { id: 72, created_at: '2013/01/22/230658' },
        { id: 73, created_at: '2013/02/05/222615' },
        { id: 74, created_at: '2013/02/11/151517' },
        { id: 75, created_at: '2013/02/15/010648' },
        { id: 76, created_at: '2013/02/21/202952' },
        { id: 77, created_at: '2013/02/24/232908' },
        { id: 78, created_at: '2013/03/03/215955' },
        { id: 79, created_at: '2013/03/18/230456' },
        { id: 80, created_at: '2013/03/23/141906' },
        { id: 81, created_at: '2013/03/28/214052' },
        { id: 82, created_at: '2013/03/30/220603' },
        { id: 83, created_at: '2013/04/05/150923' },
        { id: 84, created_at: '2013/04/07/170941' },
        { id: 85, created_at: '2013/04/09/115216' },
        { id: 86, created_at: '2013/04/10/213823' },
        { id: 87, created_at: '2013/04/15/173751' },
        { id: 88, created_at: '2013/04/20/134700' },
        { id: 89, created_at: '2013/04/20/192514' },
        { id: 90, created_at: '2013/04/22/002544' },
        { id: 91, created_at: '2013/05/25/173319' },
        { id: 92, created_at: '2013/06/02/230210' },
        { id: 93, created_at: '2013/06/05/150612' },
        { id: 94, created_at: '2013/06/06/112501' },
        { id: 95, created_at: '2013/06/09/204823' },
        { id: 96, created_at: '2013/06/12/212614' },
        { id: 97, created_at: '2013/06/21/132806' },
        { id: 98, created_at: '2013/06/25/175715' },
        { id: 99, created_at: '2013/06/29/220258' },
        { id: 100, created_at: '2013/07/02/230352' },
        { id: 101, created_at: '2013/07/04/200709' },
        { id: 102, created_at: '2013/07/06/223050' },
        { id: 103, created_at: '2013/07/08/220714' },
        { id: 105, created_at: '2013/07/09/221538' },
        { id: 106, created_at: '2013/07/17/160226' },
        { id: 107, created_at: '2013/07/19/124517' },
        { id: 108, created_at: '2013/08/06/152034' },
        { id: 109, created_at: '2013/08/14/010514' },
        { id: 110, created_at: '2013/09/01/233037' },
        { id: 111, created_at: '2013/09/23/231905' },
        { id: 112, created_at: '2013/12/06/204630' },
        { id: 113, created_at: '2014/02/15/134607' },
        { id: 114, created_at: '2014/03/29/214430' },
        { id: 115, created_at: '2014/04/19/213843' },
        { id: 116, created_at: '2014/04/23/223207' },
        { id: 117, created_at: '2014/05/03/000418' },
        { id: 118, created_at: '2014/05/10/145319' },
        { id: 119, created_at: '2014/05/20/115035' },
        { id: 120, created_at: '2014/05/22/091217' },
        { id: 121, created_at: '2014/05/22/095547' },
        { id: 122, created_at: '2014/05/27/114758' },
        { id: 123, created_at: '2014/05/27/181958' },
        { id: 124, created_at: '2014/06/02/122755' },
        { id: 125, created_at: '2014/06/04/170031' },
        { id: 126, created_at: '2014/06/10/142341' },
        { id: 127, created_at: '2014/06/11/130100' },
        { id: 128, created_at: '2014/06/15/201153' },
        { id: 129, created_at: '2014/06/15/212022' },
        { id: 130, created_at: '2014/06/16/233539' },
        { id: 131, created_at: '2014/06/18/105912' },
        { id: 132, created_at: '2014/06/22/134946' },
        { id: 133, created_at: '2014/06/25/131649' },
        { id: 134, created_at: '2014/07/01/143512' },
        { id: 135, created_at: '2014/07/01/165751' },
        { id: 136, created_at: '2014/07/01/172549' },
        { id: 137, created_at: '2014/07/06/050150' },
        { id: 138, created_at: '2014/07/13/184145' },
        { id: 139, created_at: '2014/07/20/224323' },
        { id: 140, created_at: '2014/08/06/121051' },
        { id: 141, created_at: '2014/09/21/160543' },
        { id: 142, created_at: '2014/10/22/141708' },
        { id: 143, created_at: '2014/10/28/135311' },
        { id: 145, created_at: '2014/10/31/072539' },
        { id: 146, created_at: '2014/11/01/150344' },
        { id: 147, created_at: '2014/11/17/070129' },
        { id: 148, created_at: '2014/11/19/133509' },
        { id: 149, created_at: '2014/12/22/075921' },
        { id: 150, created_at: '2015/01/01/103223' },
        { id: 151, created_at: '2015/01/01/131533' },
        { id: 152, created_at: '2015/01/05/021926' },
        { id: 153, created_at: '2015/01/22/064515' },
        { id: 154, created_at: '2015/01/23/144705' },
        { id: 155, created_at: '2015/02/04/131421' },
        { id: 156, created_at: '2015/02/24/155006' },
        { id: 157, created_at: '2015/02/25/034823' },
        { id: 158, created_at: '2015/05/21/100926' },
        { id: 159, created_at: '2015/05/21/120431' },
        { id: 160, created_at: '2015/06/12/063731' },
        { id: 161, created_at: '2015/06/15/011640' }].freeze
